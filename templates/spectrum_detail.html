{% extends "base.html" %}

{% block head %}
    <script type="text/javascript" src="/static/js/d3.js"></script>
    <script src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>
    <link rel="stylesheet" type="text/css" href="/static/css/graph.css" />
    <link rel="stylesheet" href="http://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css" />
    <style type="text/css">        
        #details table{
            width:100%;
        }
        .span10 h1{
            text-align: center;
        }
        #frame{
            width:30px;
            margin:0;
            text-align: center;
        }
        #frame-slider{
            height: 10px;
            margin: 10px 10px;
        }
        #options{
            padding:1em;
            border: 1px solid black;
        }
        .graph{
            position:relative;
        }
        #loadingscreen{
            top:0;
            bottom:0;
            left:0;
            right:0;
            position:absolute;
            width:100%;
            height:100%;
            background-color: rgba(0,0,0,0.9);
        }
        #loadingscreen img{
            margin:250px 50%;
        }
        #startFrame, #endFrame, #runAnimation, #loadData{
            margin-bottom: 10px;
        }
        #runAnimation{
            display:none;
        }
        #startFrame, #endFrame{
            width:60px;
        }
        progress {
            width:500px;
            height:20px;
            display:none;
        }
        progress::-webkit-progress-bar {
            width:500px;
            height:20px;
        }
        progress::-webkit-progress-value {
            width:500px;
            height:20px;
        }
        progress::-moz-progress-bar {
            width:500px;
            height:20px;
        }

    </style>
    <script type="text/javascript">
    var m_id = {{meta_data.m_id}};
    $(function() {
        // preloadData(0,100);
        $( "#frame-slider" ).slider({
            value: 0,
            min: 0,
            max: 1000,
            slide: function( event, ui ){
                getData(ui.value);
                $("#frame").val(ui.value);
                if(ui.value < parseInt($("#startFrame").val())){
                    $("#startFrame").val(ui.value);
                    $("#startFrame").change();
                }
                if(ui.value > parseInt($("#endFrame").val())){
                    $("#endFrame").val(ui.value);
                    $("#endFrame").change();
                }
            },
            change: function(event, ui){
                getData(ui.value);
                $("#frame").val(ui.value);
            }
        });
        $("#frame").change(function(){
            $("#frame-slider").slider("option", "value", $(this).val().replace(/[a-zA-Z]/g, ""));
        });
        $("#loadData").click(function(){
            if($("#startFrame").val()!="" && $("#endFrame").val()!=""){
                preloadData($("#startFrame").val(), $("#endFrame").val());
            }
        });
        $("#startFrame").change(function(){
            $("#runAnimation").hide();
        });
        $("#endFrame").change(function(){
            $("#runAnimation").hide();
        });
        $("#runAnimation").click(function(){
            if(animation){
                animation = clearInterval(animation);
                $(this).text("Start");
            }else{
                runAnimation(50)
                $(this).text("Stop")
            }
        })
    });
    </script>
{% endblock head %}

{% block nav %}
    <li class="nav-header">Index</li>
    <li><a href="#graph">Graph</a></li>
    <li><a href="#details">Details</a></li>
    <li><a href="/plot/{{meta_data.m_id}}/img/?download=1">Download Image</a></li>
{% endblock nav %}

{% block content %}
    <h1>Plot {{meta_data.m_id}}</h1>
    <div class="graph" id="graph" oncontextmenu="return false">
        <h2>Spectrum Graph</h2>

    </div>
    <script type="text/javascript" src="/static/js/spectrum_graph.js"></script>
    <div id = "options">
        <div id="graphOptions">
            <h4>Graph Options</h4>
            <div class="btn-group">
                <button class="btn" href="#" onclick="moveFrame(-1)"><i class="icon-chevron-left"></i></button>
                <input type="text" id="frame" value="0"/>
                <button class="btn" href="#" onclick="moveFrame(1)"><i class="icon-chevron-right"></i></button>
                <button id = "restore" class="btn" onclick = "restoreScale()">Fit Graph</button>
            </div>
            <div id="frame-slider"></div>
        </div>
        <div id="animationSettings">
            <h4>Animation Settings</h4>
            <progress value="50" max="100"></progress>
            <p>
                Animate from <input type="number" min="0" placeholder="start" id="startFrame"/> to 
                <input type="number" min="0" placeholder="end" id="endFrame"/>
                <button class="btn" type="submit" id="loadData">Load Data</button>
                <button class="btn" type="submit" id="runAnimation">Start</button>
            </p>
        </div>
    </div>
    <div id="details">
        <h2>Spectrum Details</h2>
        <table class="table table-striped table-hover table-condensed">
            <thead>
                <tr>
                    <th>Attribute</th>
                    <th>Value</th>
                </tr>
            </thead>
            <tbody>
                {% for detail in details %}
                <tr>
                    <td>{{detail.0|capfirst}}</td>
                    <td>{{detail.1}}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
{% endblock content %}
